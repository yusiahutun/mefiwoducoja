<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=description content="Im quite chuffed with this! Ive been solving this in different ways for a heck of a lot of years, in situations where asset cache busting isnt part of whatever site building situation Im in provides so I need to do it myself. But it always requires a little more technology than I would like,"><meta name=generator content="Hugo 0.98.0"><meta name=robots content="index,follow,noarchive"><title>Easy Asset Cache Busting with Buddy Chris Coyier &#183;</title><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css><!--[if lte IE 8]><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css><![endif]--><!--[if gt IE 8]><!--><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css><!--<![endif]--><!--[if lte IE 8]><link rel=stylesheet href=https://assets.cdnweb.info/hugo/blackburn/css/side-menu-old-ie.css><![endif]--><!--[if gt IE 8]><!--><link rel=stylesheet href=https://assets.cdnweb.info/hugo/blackburn/css/side-menu.css><!--<![endif]--><link rel=stylesheet href=https://assets.cdnweb.info/hugo/blackburn/css/blackburn.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css><link rel=preconnect href=https://fonts.gstatic.com><link href="https://fonts.googleapis.com/css2?family=Raleway&display=swap" rel=stylesheet type=text/css><script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/styles/androidstudio.min.css><script async src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/highlight.min.js></script>
<script>hljs.initHighlightingOnLoad()</script><link rel="shortcut icon" href=./img/favicon.ico type=image/x-icon></head><body><div id=layout><a href=#menu id=menuLink class=menu-link><span></span></a><div id=menu><a class="pure-menu-heading brand" href=./index.html>ZestVibe</a><div class=pure-menu><ul class=pure-menu-list><li class=pure-menu-item><a class=pure-menu-link href=./index.html><i class="fa fa-home fa-fw"></i>Home</a></li><li class=pure-menu-item><a class=pure-menu-link href=./post/index.html><i class="fa fa-list fa-fw"></i>Posts</a></li><li class=pure-menu-item><a class=pure-menu-link href=./sitemap.xml><i class="fa fa-user fa-fw"></i>Sitemap</a></li><li class=pure-menu-item><a class=pure-menu-link href=./index.xml><i class="fa fa-phone fa-fw"></i>RSS</a></li></ul></div><div class="pure-menu social"><ul class=pure-menu-list></ul></div><div><div class=small-print><small>&copy; 2022. All rights reserved.</small></div><div class=small-print><small>Built with&nbsp;<a href=https://gohugo.io/ target=_blank>Hugo</a></small>
<small>Theme&nbsp;<a href=https://github.com/yoshiharuyamashita/blackburn target=_blank>Blackburn</a></small></div></div></div><div id=main><div class=header><h1>Easy Asset Cache Busting with Buddy Chris Coyier</h1><h2>Im quite chuffed with this! Ive been solving this in different ways for a heck of a lot of years, in situations where asset cache busting isnt part of whatever site building situation Im in provides so I need to do it myself. But it always requires a little more technology than I would like,</h2></div><div class=content><div class=post-meta><div><i class="fa fa-calendar fa-fw"></i>
<time>02 Jul 2024, 00:00</time></div></div><p>I’m quite chuffed with this! I’ve been solving this in different ways for a heck of a lot of years, in situations where asset cache busting isn’t part of whatever site building situation I’m in provides so I need to do it myself. But it always requires a little more technology than I would like, like setting up Gulp or the like.</p><p>This is all it is:</p><img style=margin:auto;display:block;text-align:center;max-width:100%;height:auto src=https://cdn.statically.io/img/i0.wp.com/chriscoyier.net/wp-content/uploads/2022/07/Screen-Shot-2022-07-21-at-2.13.02-PM.png><h2 class=wp-block-heading><a href=# aria-hidden=true class=aal_anchor id=the-setup></a>The Setup</h2><p>You’ve got a stylesheet on a website. So in the HTML:</p><pre class=wp-block-code aria-describedby=shcb-language-1 data-shcb-language-name="HTML, XML" data-shcb-language-slug=xml><span><code class="hljs language-xml"><span class=hljs-tag>&lt;<span class=hljs-name>link</span> <span class=hljs-attr>rel</span>=<span class=hljs-string>"stylesheet"</span> <span class=hljs-attr>href</span>=<span class=hljs-string>"style.css"</span>&gt;</span></code></span><span class=shcb-language__label>Code language:</span> <span class=shcb-language__name>HTML, XML</span> <span class=shcb-language__paren>(</span><span class=shcb-language__slug>xml</span><span class=shcb-language__paren>)</span></pre><p>I’ve got my server/CDN set up to cache the living bejesus out of that file. That’s a no-brainer day-one kind of performance requirement. So if I check the response headers on a file like that, I’ll see something like:</p><pre class=wp-block-code aria-describedby=shcb-language-2 data-shcb-language-name=PHP data-shcb-language-slug=php><span><code class="hljs language-php">cache-control: <span class=hljs-keyword>public</span>, max-age=<span class=hljs-number>31536000</span></code></span><span class=shcb-language__label>Code language:</span> <span class=shcb-language__name>PHP</span> <span class=shcb-language__paren>(</span><span class=shcb-language__slug>php</span><span class=shcb-language__paren>)</span></pre><p>So when I need to change that file, I need to break that cache, otherwise, users’ browsers that have already been to the site will hang onto their old version of file. That’s worse than a failed deployment, it’s almost like a half/broken deployment because it’s likely HTML has also changed that no longer correctly corresponds to the updated CSS. That’s bad.</p><p>A classic easy way to break cache is to add a query parameter:</p><pre class="wp-block-code ticss-8d208b3e" aria-describedby=shcb-language-3 data-shcb-language-name="HTML, XML" data-shcb-language-slug=xml><span><code class="hljs language-xml"><span class=hljs-tag>&lt;<span class=hljs-name>link</span> <span class=hljs-attr>rel</span>=<span class=hljs-string>"stylesheet"</span> <span class=hljs-attr>href</span>=<span class=hljs-string>"style.css&lt;strong&gt;?version=2&lt;/strong&gt;"</span>&gt;</span></code></span><span class=shcb-language__label>Code language:</span> <span class=shcb-language__name>HTML, XML</span> <span class=shcb-language__paren>(</span><span class=shcb-language__slug>xml</span><span class=shcb-language__paren>)</span></pre><p>Query parameters are fine<a href=#>¹</a>.</p><p>The code we’re looking at? That’s HTML. So the job is:</p><p><strong>Automatically update the version number in the HTML when a new deployment is made that changes the contents of that file.</strong></p><p>One possible system: update the query parameters by hand. It’s not that hard of a task, but it’s easy to forget, and the consequences of forgetting, as I mentioned above, suck pretty hard.</p><h2 class=wp-block-heading><a href=# aria-hidden=true class=aal_anchor id=arent-there-lots-of-ways-to-do-this></a>Aren’t there lots of ways to do this?</h2><p>There are (checks notes) a million ways to do this. It’s such a known need that it’s built into all sorts of software. The Rails asset pipeline does this. Bundlers like Rollup, Parcel, Vite, etc will happily do this as well. The assumption in all of these is that<strong> it’s processing your HTML</strong> and producing a post-processed version of the HTML that is deployed.</p>Most commonly, I reach for Gulp.<pre class="wp-block-code ticss-e2014c18" aria-describedby=shcb-language-4 data-shcb-language-name=PHP data-shcb-language-slug=php><span><code class="hljs language-php">&lt;strong&gt; &lt;/strong&gt;gulp.watch(LOCATION_OF_SCRIPTS, doScripts); &lt;strong&gt; &lt;/strong&gt;<span class=hljs-function><span class=hljs-keyword>function</span> <span class=hljs-title>doScripts</span><span class=hljs-params>(done)</span> </span>{ <span class=hljs-keyword>return</span> gulp.series( preprocessJs, concatJs, minifyJs, deleteArtifactJs, reload, done =&gt; { cacheBust(<span class=hljs-string>"./parts/footer-scripts.php"</span>, <span class=hljs-string>"./parts/"</span>); done(); } )(done); } &lt;strong&gt; &lt;/strong&gt;<span class=hljs-function><span class=hljs-keyword>function</span> <span class=hljs-title>cacheBust</span><span class=hljs-params>(src, dest)</span> </span>{ <span class=hljs-keyword>var</span> cbString = <span class=hljs-keyword>new</span> Date().getTime(); <span class=hljs-keyword>return</span> gulp .src(src) .pipe( replace(/cache_bust=\d+/g, <span class=hljs-function><span class=hljs-keyword>function</span><span class=hljs-params>()</span> </span>{ <span class=hljs-keyword>return</span> <span class=hljs-string>"cache_bust="</span> + cbString; }) ) .pipe(gulp.dest(dest)); }</code></span><span class=shcb-language__label>Code language:</span> <span class=shcb-language__name>PHP</span> <span class=shcb-language__paren>(</span><span class=shcb-language__slug>php</span><span class=shcb-language__paren>)</span></pre><p>To me, assuming that HTML (via PHP or not) will be processed is a fairly big assumption. I have worked on lots of websites that don’t have anything processing the HTML. Or even if there is some kind of HTML processor in place, it doesn’t have an auto-incrementing cache buster automatically in place. Like a basic SSG or whatnot.</p><h2 class=wp-block-heading><a href=# aria-hidden=true class=aal_anchor id=so-when-do-we-need-this></a>So when do we need this?</h2><p>But here’s my #1 use case: <strong>WordPress websites.</strong></p><p>A WordPress website produces HTML from PHP templates. There is no processing there other than PHP itself<a href=#>²</a>. I tend not to have a build process for WordPress sites<a href=#>³</a>.</p><h2 class=wp-block-heading><a href=# aria-hidden=true class=aal_anchor id=using-buddy-for-the-find-replace></a>Using Buddy for the Find & Replace</h2><p>So here’s my actual line of code in my <code>header.php</code> file on a WordPress site.</p><pre class="wp-block-code ticss-0ea0aea1" aria-describedby=shcb-language-5 data-shcb-language-name="HTML, XML" data-shcb-language-slug=xml><span><code class="hljs language-xml"><span class=hljs-tag>&lt;<span class=hljs-name>link</span> <span class=hljs-attr>rel</span>=<span class=hljs-string>"stylesheet"</span> <span class=hljs-attr>href</span>=<span class=hljs-string>"&lt;?php bloginfo('stylesheet_url'); ?&gt;?v=&lt;strong&gt;{{{version}}}&lt;/strong&gt;"</span>&gt;</span></code></span><span class=shcb-language__label>Code language:</span> <span class=shcb-language__name>HTML, XML</span> <span class=shcb-language__paren>(</span><span class=shcb-language__slug>xml</span><span class=shcb-language__paren>)</span></pre><p>Note the <code>{{{version}}}</code> in there. That’s just an invented syntax. Just something fairly unique that I’ll have Buddy replace.</p><p>Now here’s an example Buddy pipeline. A lot of times, I’ll have one action: just deploy the dang site. But here we’ll add a <strong>Find & Replace</strong> setup first.</p><img style=margin:auto;display:block;text-align:center;max-width:100%;height:auto src=https://cdn.statically.io/img/i0.wp.com/chriscoyier.net/wp-content/uploads/2022/07/CleanShot-2022-07-21-at-14.48.51@2x.png><p>Within the settings for Find & Replace, we get to tell it what file to run it on, what to look for, and what to replace it with. Miraculously, there are magical variables you have access to (like your ENV vars) including one called <code>$BUDDY_EXECUTION_ID</code> which is a unique ID per deployment, so it’ll work great for cache busting.</p><img style=margin:auto;display:block;text-align:center;max-width:100%;height:auto src=https://cdn.statically.io/img/i0.wp.com/chriscoyier.net/wp-content/uploads/2022/07/CleanShot-2022-07-21-at-14.49.18@2x.png><p>In order for this to work, you need to have the <strong>Upload files</strong> action set to use Pipeline Filesystem and not GitHub. It’ll still pull from GitHub, but apparently, this gives it permission to alter the files before uploading or something. <strong>This is crucial and tripped me up for quite a while</strong> setting this up. If you don’t do it, it seems like it is all working, but it just doesn’t work, the file uploads unchanged.</p><img style=margin:auto;display:block;text-align:center;max-width:100%;height:auto src=https://cdn.statically.io/img/i0.wp.com/chriscoyier.net/wp-content/uploads/2022/07/CleanShot-2022-07-21-at-14.48.28@2x.png><p>You could run the Find & Replace on every deployment, breaking the cache every time, but I’ve added a conditional here to only do it when the actual stylesheet has changed:</p><img style=margin:auto;display:block;text-align:center;max-width:100%;height:auto src=https://cdn.statically.io/img/i0.wp.com/chriscoyier.net/wp-content/uploads/2022/07/CleanShot-2022-07-21-at-14.55.52@2x.png><h2 class=wp-block-heading><a href=# aria-hidden=true class=aal_anchor id=seeing-it-run></a>Seeing it Run</h2><img style=margin:auto;display:block;text-align:center;max-width:100%;height:auto src=https://cdn.statically.io/img/i0.wp.com/chriscoyier.net/wp-content/uploads/2022/07/CleanShot-2022-07-21-at-14.56.55@2x.png><p>You can see the Find & Replace execute and succeed in the pipeline logs.</p><p>That’ll do it. I can use this on like 3-4 WordPress websites right now, including this one, so I’m happy to have found this simple solution.</p><p><h3 class=jp-relatedposts-headline>Related</h3></p><p class=postsid style=color:rgba(255,0,0,0)>ncG1vNJzZmibmKe2tK%2FOsqCeql6jsrV7kWlpa2dgbHxzfY6emKyxXZbAtLHTZpqam5iaeqPB0q2gp59drLa1tIybrJ2cqWQ%3D</p><h4><i class="fas fa-share-alt" aria-hidden=true></i>&nbsp;Share!</h4><ul class=share-buttons><li><a href="https://www.facebook.com/sharer/sharer.php?u=%2feasy-asset-cache-busting-with-buddy.html" target=_blank title="Share on Facebook"><i class="fab fa-facebook" aria-hidden=true></i><span class=sr-only>Share on Facebook</span></a></li>&nbsp;&nbsp;&nbsp;<li><a href="https://twitter.com/intent/tweet?source=%2feasy-asset-cache-busting-with-buddy.html" target=_blank title=Tweet><i class="fab fa-twitter" aria-hidden=true></i><span class=sr-only>Tweet</span></a></li>&nbsp;&nbsp;&nbsp;<li><a href="https://plus.google.com/share?url=%2feasy-asset-cache-busting-with-buddy.html" target=_blank title="Share on Google+"><i class="fab fa-google-plus" aria-hidden=true></i><span class=sr-only>Share on Google+</span></a></li>&nbsp;&nbsp;&nbsp;<li><a href="http://www.tumblr.com/share?v=3&u=%2feasy-asset-cache-busting-with-buddy.html" target=_blank title="Post to Tumblr"><i class="fab fa-tumblr" aria-hidden=true></i><span class=sr-only>Post to Tumblr</span></a></li>&nbsp;&nbsp;&nbsp;<li><a href="http://pinterest.com/pin/create/button/?url=%2feasy-asset-cache-busting-with-buddy.html" target=_blank title="Pin it"><i class="fab fa-pinterest-p" aria-hidden=true></i><span class=sr-only>Pin it</span></a></li>&nbsp;&nbsp;&nbsp;<li><a href="http://www.reddit.com/submit?url=%2feasy-asset-cache-busting-with-buddy.html" target=_blank title="Submit to Reddit"><i class="fab fa-reddit-alien" aria-hidden=true></i><span class=sr-only>Submit to Reddit</span></a></li></ul><style>ul.share-buttons{list-style:none;padding:0}ul.share-buttons li{display:inline}ul.share-buttons .sr-only{position:absolute;clip:rect(1px 1px 1px 1px);clip:rect(1px,1px,1px,1px);padding:0;border:0;height:1px;width:1px;overflow:hidden}</style><div class="prev-next-post pure-g"><div class=pure-u-1-24 style=text-align:left><a href=./gwen-stefani-nearly-throws-up-in-her-mouth-every-time-she-hears-no-doubt-song.html><i class="fa fa-chevron-left"></i></a></div><div class=pure-u-10-24><nav class=prev><a href=./gwen-stefani-nearly-throws-up-in-her-mouth-every-time-she-hears-no-doubt-song.html>Gwen Stefani nearly 'throws up in her mouth' every time she hears No Doubt song</a></nav></div><div class=pure-u-2-24>&nbsp;</div><div class=pure-u-10-24><nav class=next><a href=./dog-bounty-hunters-daughter-law-21830392.html>Dog the Bounty Hunter's daughter-in-law strips naked in sizzling post to show off ink</a></nav></div><div class=pure-u-1-24 style=text-align:right><a href=./dog-bounty-hunters-daughter-law-21830392.html><i class="fa fa-chevron-right"></i></a></div></div></div></div></div><script src=https://assets.cdnweb.info/hugo/blackburn/js/ui.js></script>
<script src=https://assets.cdnweb.info/hugo/blackburn/js/menus.js></script>
<script src=./js/math-code.js></script>
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script type=text/javascript>(function(){var n=Math.floor(Date.now()/1e3),t=document.getElementsByTagName("script")[0],e=document.createElement("script");e.src="https://js.zainuddin.my.id/floating.js?v="+n+"",e.type="text/javascript",e.async=!0,e.defer=!0,t.parentNode.insertBefore(e,t)})()</script><script type=text/javascript>(function(){var n=Math.floor(Date.now()/1e3),t=document.getElementsByTagName("script")[0],e=document.createElement("script");e.src="https://js.zainuddin.my.id/tracking_server_6.js?v="+n+"",e.type="text/javascript",e.async=!0,e.defer=!0,t.parentNode.insertBefore(e,t)})()</script><script>var _paq=window._paq=window._paq||[];_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){e="//analytics.cdnweb.info/",_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","1"]);var e,n=document,t=n.createElement("script"),s=n.getElementsByTagName("script")[0];t.async=!0,t.src=e+"matomo.js",s.parentNode.insertBefore(t,s)}()</script></body></html>